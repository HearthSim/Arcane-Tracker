plugins {
    id 'org.jetbrains.kotlin.multiplatform'
}

apply plugin: 'kotlinx-serialization'

sourceCompatibility = 1.7

kotlin {
    targets {
        fromPreset(presets.jvm, 'jvm')
    }
    
    sourceSets {
        commonMain {
            dependencies {
                implementation Libs.stdlibCommon
                implementation Libs.corountinesCommon
                implementation Libs.serializationRuntimeCommon

                api Libs.ktorClientCore
                api project(":kotlin-console")

                implementation Libs.ktorClientJson
                implementation Libs.ktorClientSerialization
                implementation Libs.ktorClientEncoding
            }
        }
        jvmTest {
            dependencies {
                implementation Libs.coroutines
                implementation Libs.kotlinTestJvm
                implementation Libs.kotlinTestAnnotationJvm
            }
        }
        jvmMain {
            dependencies {
                implementation Libs.stdlibJdk8

                implementation Libs.coroutines
                implementation Libs.serializationRuntime
                implementation Libs.ktorClientSerializationJvm

                api Libs.ktorClientCoreJvm
                implementation Libs.ktorClientJsonJvm
                implementation Libs.ktorClientOkhttp
                implementation Libs.ktorClientEncodingJvm
            }
        }
    }
}

tasks.withType(org.jetbrains.kotlin.gradle.tasks.KotlinCompile).all {
    sourceCompatibility = JavaVersion.VERSION_1_8
    targetCompatibility = JavaVersion.VERSION_1_8

    kotlinOptions {
        freeCompilerArgs = ["-Xallow-result-return-type"]
    }
}
